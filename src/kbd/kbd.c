/*
 *                          Copyright (C) 2016, 2017 by Rafael Santiago
 *
 * This is a free software. You can redistribute it and/or modify under
 * the terms of the GNU General Public License version 2.
 *
 */

#include <kbd/kbd.h>
#include <vid/vid.h>
#include <accacia.h>

static int g_kbd_tcolor = AC_BCOLOR_WHITE;

static int g_kbd_bcolor = AC_BCOLOR_BLACK;

#define CP8_KBD_X 67

#define CP8_KBD_Y 1

#define CP8_KBD_XPAD 2

#define CP8_KBD_YPAD 1

// INFO(Rafael): Here goes all pixel maps for the retro 8-bit keys stuff.

static cp8_blitchar_pxmap_t g_kbd_k0 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x0f, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x0f, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k1 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k2 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k3 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k4 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k5 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k6 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k7 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k8 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_k9 = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_ka = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_kb = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_kc = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_kd = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0xf0, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_ke = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

static cp8_blitchar_pxmap_t g_kbd_kf = {
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0xff, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }
};

struct cp8_kbd_key_ctx {
    cp8_blitchar_pxmap_t *key;
    const int x, y;
};

int cp8_kbdhit(void) {
    return accacia_kbhit();
}

unsigned char cp8_kbdwait(void) {
    return accacia_getch();
}

void cp8_kbdinit(void) {
    // WARN(Rafael): Good luck with this awful look...

    // CLUE(Rafael): Line 1
    cp8_vidblitchar(CP8_KBD_X, CP8_KBD_Y, g_kbd_k1, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + CP8_BLITCHAR_MW + CP8_KBD_XPAD, CP8_KBD_Y, g_kbd_k2, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (2 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y, g_kbd_k3, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (3 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y, g_kbd_kc, g_kbd_tcolor, g_kbd_bcolor);

    // CLUE(Rafael): Line 2
    cp8_vidblitchar(CP8_KBD_X, CP8_KBD_Y + CP8_BLITCHAR_MH + CP8_KBD_YPAD, g_kbd_k4, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + CP8_BLITCHAR_MW + CP8_KBD_XPAD, CP8_KBD_Y + CP8_BLITCHAR_MH + CP8_KBD_YPAD, g_kbd_k5, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (2 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + CP8_BLITCHAR_MH + CP8_KBD_YPAD, g_kbd_k6, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (3 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + CP8_BLITCHAR_MH + CP8_KBD_YPAD, g_kbd_kd, g_kbd_tcolor, g_kbd_bcolor);

    // CLUE(Rafael): Line 3
    cp8_vidblitchar(CP8_KBD_X, CP8_KBD_Y + (2 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_k7, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + CP8_BLITCHAR_MW + CP8_KBD_XPAD, CP8_KBD_Y + (2 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_k8, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (2 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + (2 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_k9, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (3 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + (2 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_ke, g_kbd_tcolor, g_kbd_bcolor);

    // CLUE(Rafael): Line 4
    cp8_vidblitchar(CP8_KBD_X, CP8_KBD_Y + (3 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_ka, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + CP8_BLITCHAR_MW + CP8_KBD_XPAD, CP8_KBD_Y + (3 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_k0, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (2 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + (3 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_kb, g_kbd_tcolor, g_kbd_bcolor);
    cp8_vidblitchar(CP8_KBD_X + (3 * (CP8_BLITCHAR_MW + CP8_KBD_XPAD)), CP8_KBD_Y + (3 * (CP8_BLITCHAR_MH + CP8_KBD_YPAD)), g_kbd_kf, g_kbd_tcolor, g_kbd_bcolor);
}
